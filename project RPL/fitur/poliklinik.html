<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poliklinik - Klinik Unsri</title>
    <link rel="stylesheet" href="poliklinik.css">
</head>
<body>
    <div class="container">
        <nav class="top-nav">
            <a href="../home.html" class="top-nav-item">
                <div class="top-nav-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                </div>
                <span class="top-nav-label">Beranda</span>
            </a>
            <a href="../user/profile.html" class="top-nav-item">
                <div class="top-nav-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                </div>
                <span class="top-nav-label">Profil</span>
            </a>
            <a href="../user/riwayat.html" class="top-nav-item">
                <div class="top-nav-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                    </svg>
                </div>
                <span class="top-nav-label">Riwayat</span>
            </a>
        </nav>

        <div class="header">
            <a href="../home.html" class="back-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                </svg>
                Kembali
            </a>
            <h1 class="page-title">Poliklinik</h1>
        </div>

        <div class="tab-container">
            <button class="tab active" onclick="showTab('Umum', event)">Poli Umum</button>
            <button class="tab" onclick="showTab('THT', event)">Poli Gigi</button> <button class="tab" onclick="showTab('Gigi', event)">Poli Anak</button> </div>

        <div id="content-area" class="content">
            <p style="text-align:center; margin-top:50px;">Memuat jadwal dokter...</p>
        </div>
    </div>

    <script>
        let allDataJadwal = [];

        // 1. Load Data dari Database saat halaman dibuka
        async function loadJadwal() {
            try {
                // Fetch ke endpoint yang sama dengan Admin
                const response = await fetch('http://localhost:3000/users/jadwal-dokter');
                const result = await response.json();
                
                if (result.data) {
                    allDataJadwal = result.data;
                    // Tampilkan tab default (Umum)
                    renderDokter('Umum');
                }
            } catch (error) {
                console.error(error);
                document.getElementById('content-area').innerHTML = '<p style="text-align:center; color:red;">Gagal memuat jadwal.</p>';
            }
        }

        // 2. Fungsi Menampilkan Kartu Dokter
        function renderDokter(poliFilter) {
            const container = document.getElementById('content-area');
            container.innerHTML = ""; // Bersihkan isi lama

            // Filter data sesuai tab yang dipilih
            const dataPoli = allDataJadwal.filter(item => item.poli === poliFilter);

            if (dataPoli.length === 0) {
                container.innerHTML = `<p style="text-align:center; color:gray; margin-top:20px;">Tidak ada jadwal dokter untuk poli ini.</p>`;
                return;
            }

            // Kelompokkan data berdasarkan Nama Dokter
            // (Karena 1 dokter punya banyak baris jadwal/hari)
            const grouped = {};
            dataPoli.forEach(item => {
                if(!grouped[item.nama_dokter]) grouped[item.nama_dokter] = [];
                grouped[item.nama_dokter].push(item);
            });

            // Loop setiap dokter dan buat Kartu HTML
            for (const [dokter, jadwalList] of Object.entries(grouped)) {
                
                // Urutkan hari (Senin -> Minggu)
                const urutan = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];
                jadwalList.sort((a, b) => urutan.indexOf(a.hari) - urutan.indexOf(b.hari));

                // Buat baris-baris jam
                let rowsHTML = "";
                jadwalList.forEach(jadwal => {
                    rowsHTML += `
                        <div class="schedule-row">
                            <span class="label">${jadwal.hari}</span>
                            <span class="time">${jadwal.jam}</span>
                        </div>
                    `;
                });

                // Gabungkan jadi Kartu Dokter
                const cardHTML = `
                    <div class="doctor-card">
                        <div class="doctor-photo">
                            <img src="../aset/gambar-dokter.png" alt="Doctor">
                        </div>
                        <div class="doctor-details">
                            <h3 class="doctor-name">${dokter}</h3>
                            <div class="schedule-info">
                                ${rowsHTML}
                            </div>
                        </div>
                    </div>
                `;
                
                container.innerHTML += cardHTML;
            }
        }

        // 3. Fungsi Ganti Tab (Dipanggil saat klik tombol)
        function showTab(poliName, event) {
            // Update tampilan tombol aktif
            document.querySelectorAll('.tab').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Render ulang konten sesuai poli
            renderDokter(poliName);
        }

        // Jalankan
        loadJadwal();
    </script>
</body>
</html>